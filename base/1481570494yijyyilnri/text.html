<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono';">Rebase</span> — один из двух способов объединить изменения, сделанные в одной ветке, с другой веткой. Начинающие и даже опытные пользователи <span style=" font-family:'FreeMono';">git</span> иногда испытывают нежелание пользоваться ей, так как не видят смысла осваивать еще один способ объединять изменения, когда уже и так прекрасно владеют операцией <span style=" font-family:'FreeMono';">merge</span>. В этой статье я бы хотел подробно разобрать теорию и практику использования <span style=" font-family:'FreeMono';">rebase</span>.</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Теория</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Итак, освежим теоретические знания о том, что же такое <span style=" font-family:'FreeMono';">rebase</span>. Для начала вкратце — у вас есть две ветки — <span style=" font-family:'FreeMono';">master</span> и <span style=" font-family:'FreeMono';">feature</span>, обе локальные, <span style=" font-family:'FreeMono';">feature</span> была создана от <span style=" font-family:'FreeMono';">master</span> в состоянии <span style=" font-family:'FreeMono';">A</span> и содержит в себе коммиты <span style=" font-family:'FreeMono';">C</span>, <span style=" font-family:'FreeMono';">D</span> и <span style=" font-family:'FreeMono';">E</span>. В ветку <span style=" font-family:'FreeMono';">master</span> после отделения от нее ветки <span style=" font-family:'FreeMono';">feature</span> был сделан 1 коммит <span style=" font-family:'FreeMono';">B</span>. <br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1979130481.png" /><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> После применения операции <span style=" font-family:'FreeMono'; color:#6a1009;">rebase master</span> в ветке <span style=" font-family:'FreeMono';">feature</span>, дерево коммитов будет иметь вид:<br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image182779556.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Обратите внимание, что коммиты <span style=" font-family:'FreeMono';">C'</span>, <span style=" font-family:'FreeMono';">D'</span> и <span style=" font-family:'FreeMono';">E'</span> — не равны <span style=" font-family:'FreeMono';">C</span>, <span style=" font-family:'FreeMono';">D</span> и <span style=" font-family:'FreeMono';">E</span>, они имеют другие хеши, но изменения (дельты), которые они в себе несут, в идеале точно такие же. Отличие в коммитах обусловлено тем, что они имеют другую базу (в первом случае — <span style=" font-family:'FreeMono';">A</span>, во втором — <span style=" font-family:'FreeMono';">B</span>), отличия в дельтах, если они есть, обусловлены разрешением конфликтных ситуаций, возникших при <span style=" font-family:'FreeMono';">rebase</span>. Об этом чуть подробнее далее.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Такое состояние имеет одно важное преимущество перед первым, при слиянии ветки <span style=" font-family:'FreeMono';">feature</span> в <span style=" font-family:'FreeMono';">master</span> ветка может быть объединена по <span style=" font-family:'FreeMono';">fast-forward</span>, что исключает возникновение конфликтов при выполнении этой операции, кроме того, код в ветке <span style=" font-family:'FreeMono';">feature</span> более актуален, так как учитывает изменения сделанные в ветке <span style=" font-family:'FreeMono';">master</span> в коммите <span style=" font-family:'FreeMono';">B</span>.</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Процесс </span><span style=" font-family:'FreeMono'; font-weight:600;">rebase</span><span style=" font-weight:600;">-а детально</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Давайте теперь разберемся с механикой этого процесса, как именно дерево 1 превратилось в дерево 2?</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Напомню, перед <span style=" font-family:'FreeMono';">rebase</span> вы находтесь в ветке <span style=" font-family:'FreeMono';">feature</span>, то есть ваш <span style=" font-family:'FreeMono';">HEAD</span> смотрит на указатель <span style=" font-family:'FreeMono';">feature</span>, который в свою очередь смотрит на коммит <span style=" font-family:'FreeMono';">E</span>. Идентификатор ветки <span style=" font-family:'FreeMono';">master</span> вы передаете в команду как аргумент: <br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">git rebase master</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для начала <span style=" font-family:'FreeMono';">git</span> находит базовый коммит — общий родитель этих двух состояний. В данном случае это коммит <span style=" font-family:'FreeMono';">A</span>. Далее двигаясь в направлении вашего текущего <span style=" font-family:'FreeMono';">HEAD</span> <span style=" font-family:'FreeMono';">git</span> вычисляет разницу для каждой пары коммитов, на первом шаге между <span style=" font-family:'FreeMono';">A</span> и <span style=" font-family:'FreeMono';">С</span>, назовем ее <span style=" font-family:'FreeMono';">ΔAC</span>. Эта дельта применяется к текущему состоянию ветки master. Если при этом не возникает конфликтное состояние, создается коммит <span style=" font-family:'FreeMono';">C'</span>, таким образом <span style=" font-family:'FreeMono';">C'</span> = <span style=" font-family:'FreeMono';">B</span> + <span style=" font-family:'FreeMono';">ΔAC</span>. Ветки <span style=" font-family:'FreeMono';">master</span> и <span style=" font-family:'FreeMono';">feature</span> при этом не смещаются, однако, <span style=" font-family:'FreeMono';">HEAD</span> перемещается на новый коммит (<span style=" font-family:'FreeMono';">C'</span>), приводя ваш репозитарий состояние «отделеной головы» (<span style=" font-family:'FreeMono';">detached HEAD</span>).</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1908437468.png" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Успешно создав коммит <span style=" font-family:'FreeMono';">C'</span>, <span style=" font-family:'FreeMono';">git</span> переходит к переносу следующих изменений — <span style=" font-family:'FreeMono';">ΔCD</span>. Предположим, что при наложении этих изменний на коммит <span style=" font-family:'FreeMono';">C'</span> возник конфликт. Процесс <span style=" font-family:'FreeMono';">rebase</span> останавливается (именно в этот момент, набрав <span style=" font-family:'FreeMono'; color:#6a1009;">git status</span> вы можете обнаружить, что находитесь в состоянии <span style=" font-family:'FreeMono';">detached HEAD</span>). Изменения, внесенные <span style=" font-family:'FreeMono';">ΔCD</span> находятся в вашей рабочей копии и (кроме конфликтных) подготовлены к коммиту (пунктиром обозначена <span style=" font-family:'FreeMono';">stage</span>-зона):</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image171775364.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Далее вы можете предпринять следующие шаги:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1. Отменить процесс <span style=" font-family:'FreeMono';">rebase</span> набрав в консоли </p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">git rebase --abort</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">При этом маркер <span style=" font-family:'FreeMono';">HEAD</span>, будет перенесен обратно на ветку <span style=" font-family:'FreeMono';">feature</span>, а уже добавленные коммиты повиснут в воздухе (на них не будет указывать ни один указатель) и будут вскоре удалены.<br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">2. Разрешить конфликт в вашем любимом <span style=" font-family:'FreeMono';">merge</span>-<span style=" font-family:'FreeMono';">tool</span>'е, подготовить файлы к коммиту, набрав <span style=" font-family:'FreeMono'; color:#6a1009;">git add %filename%</span>. Проделав это со всеми конфликтными файлами, продолжить процесс <span style=" font-family:'FreeMono';">rebase</span>-а набрав в консоли</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">git rebase --continue</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">При этом, если все конфликты действительно разрешены, будет создан коммит <span style=" font-family:'FreeMono';">D'</span> и <span style=" font-family:'FreeMono';">rebase</span> перейдет к следующему, в данном примере последнему шагу.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">3. Если изменения, сделанные при формировании коммита <span style=" font-family:'FreeMono';">B</span> и коммита <span style=" font-family:'FreeMono';">D</span> являются полностью взаимоисключающими, причем «правильные» изменения сделаны в коммите <span style=" font-family:'FreeMono';">B</span>, то вы не сможете продолжить набрав <span style=" font-family:'FreeMono'; color:#6a1009;">git rebase --continue</span>, так как разрешив конфликты обнаружите, что изменений в рабочей копии нет. В данном случае вам надо пропустить создание коммита <span style=" font-family:'FreeMono';">D'</span>, набрав команду</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">git rebase --skip</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> После применения изменений <span style=" font-family:'FreeMono';">ΔDE</span> будет создан последний коммит <span style=" font-family:'FreeMono';">E'</span>, указатель ветки <span style=" font-family:'FreeMono';">feature</span> будет установлен на коммит <span style=" font-family:'FreeMono';">E'</span>, а <span style=" font-family:'FreeMono';">HEAD</span> станет показывать на ветку <span style=" font-family:'FreeMono';">feature</span> — теперь, вы находитесь в состоянии на втором рисунке, <span style=" font-family:'FreeMono';">rebase</span> окончен. Старые коммиты <span style=" font-family:'FreeMono';">C</span>, <span style=" font-family:'FreeMono';">D</span> и <span style=" font-family:'FreeMono';">E</span> вам больше не нужны. </p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image517082366.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">При этом коммиты, созданные в процессе <span style=" font-family:'FreeMono';">rebase</span>-а, будут содержать данные как об оригинальном авторе и дате изменений (<span style=" font-family:'FreeMono';">Author</span>), так и о пользователе, сделавшем <span style=" font-family:'FreeMono';">rebase</span> (<span style=" font-family:'FreeMono';">Commiter</span>):</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">commit 0244215614ce6886c9e7d75755601f94b8e19729</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">Author:     sloot69 &lt;***@****.com&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">AuthorDate: Mon Nov 26 13:19:08 2012 +0400</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">Commit:     Alex &lt;***@****.com&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">CommitDate: Mon Nov 26 13:33:27 2012 +0400</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">С небес на землю — <span style=" font-family:'FreeMono';">rebase</span> в реальных условиях</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">На самом деле обычно вы работаете не с двумя ветками, а с четырьмя в самом простом случае: <span style=" font-family:'FreeMono';">master</span>, <span style=" font-family:'FreeMono';">origin/master</span>, <span style=" font-family:'FreeMono';">feature</span> и <span style=" font-family:'FreeMono';">origin/feature</span>. При этом <span style=" font-family:'FreeMono';">rebase</span> возможен как между веткой и ее <span style=" font-family:'FreeMono';">origin</span>-ом, например <span style=" font-family:'FreeMono';">feature</span> и <span style=" font-family:'FreeMono';">origin/feature</span>, так и между локальными ветками <span style=" font-family:'FreeMono';">feature</span> и <span style=" font-family:'FreeMono';">master</span>.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono';">Rebase</span> ветки с <span style=" font-family:'FreeMono';">origin</span>-ом</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если вы хотите начать работать с rebase, то лучше всего начать с ребейза своих изменений в ветке относительно ее копии в удаленном репозитарии. Дело в том, что когда вы добавляете коммит, и в удаленном репозитарии добавляется коммит, для объединения изменений по-умолчанию используется <span style=" font-family:'FreeMono';">merge</span>. Выглядит это примерно так:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image286457723.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> Представим умозрительную ситуацию — 3 разработчика активно работают с веткой <span style=" font-family:'FreeMono';">master</span> в удаленном репозитарии. Делая одновременно комиты на своих машинах они отправляют каждый по 1 изменению в ветку. При этом первый отправляет их без проблем. Второй и третий сталкивается с тем что ветка не может быть отправлена операцией <span style=" font-family:'FreeMono'; color:#6a1009;">git push origin master</span>, так как в ней уже есть изменения, которые не синхронизированы на локальные машины разработчиков. Оба разработчика (2 и 3) делают <span style=" font-family:'FreeMono'; color:#6a1009;">git pull origin master</span>, создавая при этом локальные <span style=" font-family:'FreeMono';">merge</span>-коммиты у себя в репозитарии. Второй делает <span style=" font-family:'FreeMono'; color:#6a1009;">git push</span> первым. Третий при попытке отправить изменения снова сталкивается с обновлением удаленной ветки и снова делает <span style=" font-family:'FreeMono'; color:#6a1009;">git pull</span>, создавая еще один <span style=" font-family:'FreeMono';">merge</span>-коммит. И наконец, третий разработчик делает успешный <span style=" font-family:'FreeMono'; color:#6a1009;">git push origin master</span>. Если удаленный репозитарий расположен например на <span style=" font-family:'FreeMono';">github</span>, то <span style=" font-family:'FreeMono';">network</span>, то есть граф коммитов будет иметь следующий вид:<br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image849792162.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> Три коммита превратились в 6 (базовый коммит не считаем), история изменений неоправдано запутана, информация об объединении локальных веток с удаленными, на мой взгляд, лишняя. Если масштабировать эту ситуацию на несколько тематических веток и большее количество разработчиков, граф может выглядеть, например, так:</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image942539394.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Анализ изменений в таком графе неоправданно трудоемкое занятие. Как тут может помочь <span style=" font-family:'FreeMono';">rebase</span>? </p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если вместо <span style=" font-family:'FreeMono'; color:#6a1009;">git pull origin master</span> выполнить <span style=" font-family:'FreeMono'; color:#6a1009;">git pull --rebase origin master</span>, то ваши локальные изменения, подобно коммитам <span style=" font-family:'FreeMono';">C</span>, <span style=" font-family:'FreeMono';">D</span> и <span style=" font-family:'FreeMono';">E</span> из первого примера будут перенесены наверх обновленного состояния ветки <span style=" font-family:'FreeMono';">origin/master</span>, позволяя без создания дополнительных коммитов передать их на удаленный сервер с помощью <span style=" font-family:'FreeMono'; color:#6a1009;">git push origin master</span>. То есть слияние изменений будет выглядеть уже так:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image146934192.png" /><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Как видно, «лишних» <span style=" font-family:'FreeMono';">merge</span>-коммитов создано не было, ваши изменения в коммите <span style=" font-family:'FreeMono';">C</span> были использованы для создания коммита <span style=" font-family:'FreeMono';">C'</span>. Сам же коммит <span style=" font-family:'FreeMono';">C</span> остался у вас в локальном репозитарии, в удаленный репозитарий был передан только <span style=" font-family:'FreeMono';">C'</span>. Если все программисты в команде возьмут за правило пользоваться <span style=" font-family:'FreeMono'; color:#6a1009;">git pull --rebase</span>, тогда каждая из веток в удаленном репозитарии будет выглядеть линейно.</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Как поделиться веткой, к которой применен rebase с коллегой</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Подробно процесс <span style=" font-family:'FreeMono';">rebase</span>-а локальной тематической ветки отосительно ветки <span style=" font-family:'FreeMono';">master</span> был рассмотрен в самом начале статьи. Оговорюсь только, что процесс <span style=" font-family:'FreeMono';">rebase</span> содержит количество шагов равное количеству коммитов в вашей локальной ветке. Вероятность потенциальных конфликтов, как и в случае с <span style=" font-family:'FreeMono';">merge</span>, растет пропорционально росту количества коммитов в базовой ветке (<span style=" font-family:'FreeMono';">master</span>). Поэтому лучше периодически проводить <span style=" font-family:'FreeMono';">rebase</span> для долгоживущих тематических веток. Но если тематическая ветка имеет свой оригинал на удаленном сервере, как передать ветку в удаленный репозитарий? Если делать <span style=" font-family:'FreeMono';">push</span> можно только для изменений, которые могут быть приняты по <span style=" font-family:'FreeMono';">fast-forward</span>, а в данном случае, как мы знаем, это не так:</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image369206381.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Тут все просто, наберите в консоли команду:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">git push origin feature --force</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono';">Force</span>-режим просто копирует отсутствующие родительские коммиты ветки <span style=" font-family:'FreeMono';">feature</span> на <span style=" font-family:'FreeMono';">origin</span> и насильно устанавливает указатель ветки на тот же коммит, что и ваш локальный. </p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Будьте внимательны! Если вы забудете указать идентификатор ветки, то <span style=" font-family:'FreeMono';">force-push</span> будет выполнен для всех локальных веток, имеющих удаленный оригинал. При этом нужно понимать, что некоторые локальные ветки могут быть в неактуальном состоянии. То есть измененения, которые вы не успели затянуть будут удалены в <span style=" font-family:'FreeMono';">origin</span>-е. Конечно, сами коммиты не будут удалены — сбросятся только указатели ветки. Эта ситуация поправима — достаточно для каждой ветки найти человека, который последним пушил изменения в нее или уже успел их забрать. Он может сделать обычный <span style=" font-family:'FreeMono';">push</span>, вновь передав их на <span style=" font-family:'FreeMono';">origin</span>. Но вся эта морока вам ни к чему, так что лучше просто будьте внимательны.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Ваш коллега, находится в той же ситуации перед <span style=" font-family:'FreeMono';">pull</span>, в которой вы находились перед тем как сделали <span style=" font-family:'FreeMono';">push</span>. Только позиции <span style=" font-family:'FreeMono';">feature</span> и <span style=" font-family:'FreeMono';">origin/feature</span> отличаются с точностью до наоборот. Если он выполнит обычный <span style=" font-family:'FreeMono'; color:#6a1009;">git pull origin feature</span>, то произойдет попытка объединения старой и новой ветки с помощью <span style=" font-family:'FreeMono';">merge</span>. Так как старая и новая ветки содержат одни и те же изменения, то все они будут конфликтными. В данном случае нам снова поможет команда:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">git pull --rebase origin feature<br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Она заберет новую ветку <span style=" font-family:'FreeMono';">feature</span> и переместит локальные изменения вашего коллеги на ее вершину. </p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вообще <span style=" font-family:'FreeMono'; color:#6a1009;">git pull --rebase origin feature</span> — это безпроигрышный вариант, так как если <span style=" font-family:'FreeMono';">rebase</span> не требуется, произойдет обычное объединение указателей по <span style=" font-family:'FreeMono';">fast-forward</span>.<br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Реинтеграция тематической ветки в <span style=" font-family:'FreeMono';">master</span><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Мы рассмотрели все необходимые операции для работы с ветками в стиле <span style=" font-family:'FreeMono';">rebase</span>. Осталось только переключиться в ветку <span style=" font-family:'FreeMono';">master</span> и сделать <span style=" font-family:'FreeMono';">git merge feature</span>. Ветка, подготовленная <span style=" font-family:'FreeMono';">rebase</span>-ом вольется в <span style=" font-family:'FreeMono';">master</span> по <span style=" font-family:'FreeMono';">fast-forward</span>, то есть указатель будет просто перемещен вперед.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Однако, у такого подхода есть один недостаток — после <span style=" font-family:'FreeMono';">merge</span> по <span style=" font-family:'FreeMono';">fast-forward</span> будет затруднительно определить, какие коммиты были сделаны в вашей ветке, а какие в другой ветке, влитой перед вашей или непосредственно в мастере. Хорошим тоном может быть принятие в вашей команде правила — при интеграции изменений из тематической ветки в основную применять операцию <span style=" font-family:'FreeMono';">merge</span> с опцией <span style=" font-family:'FreeMono';">--no-ff</span>. При этом будет создан <span style=" font-family:'FreeMono';">merge</span>-коммит, одним из родителей которого будет позиция ветки <span style=" font-family:'FreeMono';">master</span>, другим — позиция ветки <span style=" font-family:'FreeMono';">feature</span>. Сравните граф коммитов, при объединении веток по <span style=" font-family:'FreeMono';">fast-forward</span> (слева) и c <span style=" font-family:'FreeMono';">merge</span>-коммитами, полученными с помощью опции <span style=" font-family:'FreeMono';">--no-ff</span> (справа):</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1229385158.png" /><img src="image1942600262.png" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В данном случае, на мой взгляд, <span style=" font-family:'FreeMono';">merge</span>-коммиты полезны и несут в себе информацию о моменте объединения веток. Этот граф выглядит как учебный пример, но такая структура вполне реальна при соблюдении некоторых простых правил всеми членами команды.</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Заключение</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Мы видим, что читаемость графа изменений может быть улучшена на порядок при соблюдении нескольких простых правил, хотя они и требуют небольших дополнительных временных затрат. </p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В официальном руководстве по <span style=" font-family:'FreeMono';">git</span> крайне не рекомендуют применять <span style=" font-family:'FreeMono';">rebase</span> к ветке, которая была запушена в публичный репозитарий, приводятся проблемы, связанные с <span style=" font-family:'FreeMono';">merge</span>-ем старой ветки, к которой еще не применен <span style=" font-family:'FreeMono';">rebase</span> (хранящейся у кого-то, кто успел ее загрузить из репозитария) и новой ветки, что приводит к конфликтам и появлению коммитов с одинаковыми датами и сообщениями в логе изменений, здесь мы рассмотрели, как легко можно избежать этой проблемы с помощью <span style=" font-family:'FreeMono'; color:#6a1009;">git pull --rebase</span>.<br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В данной статье сделано одно допущение. Все это верно при простой модели ветвления — есть одна главная ветка <span style=" font-family:'FreeMono';">master</span> и несколько тематических, которые создаются от нее. Когда от тематической ветки создается другая тематическая ветка, есть свои нюансы при <span style=" font-family:'FreeMono';">rebase</span>-е первичной и вторичной ветки. О них можно прочитать в том самом официальном руководстве.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Иногда споры, что же лучше <span style=" font-family:'FreeMono';">merge</span> или <span style=" font-family:'FreeMono';">rebase</span> доходят до холивара. От себя могу сказать, что в конечном счете выбор за вами, однако этот выбор не может быть продиктован уровнем владения тем или иным инструментом. Обоснованный выбор можно сделать, только когда для вас не составит труда работать и в том и в другом стиле. Я не агитирую за повсеместное использование <span style=" font-family:'FreeMono';">rebase</span>-а, а просто объясняю как им пользоваться. Надеюсь, это статья поможет вам снять вопросы, связанные с механизмом работы <span style=" font-family:'FreeMono';">rebase</span> и его применением в ежедневной работе.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html>